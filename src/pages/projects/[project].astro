---
import MainLayout from '@layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import LinkButton from '@components/LinkButton.astro';
import DetailsList from '@components/DetailsList.astro';
import PublicationDetailsList from '@components/PublicationDetailsList.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map(entry => ({
    params: { project: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---
<MainLayout title={entry.data.title} description={entry.data.description}>
  <h1 class="project-title" set:html={entry.data.title}></h1>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 pt-8">
    <aside class="lg:col-span-1">
      <div class="sticky top-8 p-6 rounded-lg bg-secondary">
        <h2 class="text-xl font-bold mb-4">Project Details</h2>
        <dl class="space-y-4">
          {entry.data.status && (
            <div>
              <dt class="font-semibold">Status</dt>
              <dd class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green text-white">
                {entry.data.status}
              </dd>
            </div>
          )}
          {(entry.data.start_date || entry.data.end_date) && (
            <div>
              <dt class="font-semibold">Dates</dt>
              <dd>
                {entry.data.start_date ? new Date(entry.data.start_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : ''} -
                {entry.data.end_date ? new Date(entry.data.end_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : ''}
              </dd>
            </div>
          )}
          {entry.data.investigators && (
            <div>
              <dt class="font-semibold">Investigators</dt>
              <dd>{entry.data.investigators.join(', ')}</dd>
            </div>
          )}
          {entry.data.founding_entity && (
            <div>
              <dt class="font-semibold">Funding</dt>
              <dd>{entry.data.founding_entity}</dd>
            </div>
          )}
          {entry.data.grant_number && (
            <div>
              <dt class="font-semibold">Grant Number</dt>
              <dd>{entry.data.grant_number}</dd>
            </div>
          )}
          {entry.data.tags && (
            <div>
              <dt class="font-semibold">Tags</dt>
              <dd class="flex flex-wrap gap-2">
                {entry.data.tags.map(tag => (
                  <span class="bg-hover-color text-text text-xs font-medium me-2 px-2.5 py-0.5 rounded">{tag}</span>
                ))}
              </dd>
            </div>
          )}
        </dl>
        {entry.data.project_site && (
          <LinkButton href={entry.data.project_site} text="Go to official project site" iconName="mdi:arrow-right" />
        )}
      </div>
    </aside>
    <article class="lg:col-span-2 space-y-8">
      <div class="prose dark:prose-invert max-w-none p-6 rounded-lg bg-secondary">
        <Content />
      </div>

      {entry.data.publications && entry.data.publications.length > 0 && (
        <PublicationDetailsList title="Related Publications" items={entry.data.publications} />
      )}
      
      {entry.data['project_talks'] && entry.data['project_talks'].length > 0 && (
        <DetailsList title="Project Talks" items={entry.data['project_talks']} />
      )}

      {entry.data['project_events'] && entry.data['project_events'].length > 0 && (
        <DetailsList title="Project Events" items={entry.data['project_events']} />
      )}
    </article>
  </div>
</MainLayout>

<style>
  .prose p {
    margin-bottom: 2rem;
  }
</style>

